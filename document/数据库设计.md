//原则是尽量容易做到添加功能,并且留下充足的空间让以后来实现一些高级功能

## ***以下是正式的数据库设计,并且会实时更新***

## ***第一部分*** 用户模块
//一般情况下权限也可以用数字表示,开发者0 管理员1 教师2 学生3 新用户4
//name和nickname不一样,nickname来自于微信昵称,而name主要来自于用户自己填写,而且一个瑜伽馆的体量出现同名的情况很少,想象一下如果在上课签到的时候,老师看到学生的昵称有长有短,还有一些念不出来的英文和符号.学生上了半年还不知道老师叫什么.同名可以在后面加数字的方式解决.也就是说nickname理论上是唯一的,但name绝对是唯一的
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    openid VARCHAR(255) unique,
    nickname VARCHAR(255),
    name VARCHAR(255) unique,
    gender BOOLEAN,
    signature varchar(64),
    is_student BOOLEAN,
    is_teacher BOOLEAN,
    is_admin BOOLEAN,
    ava_url VARCHAR(255)
);

CREATE TABLE admins (
    admin_id SERIAL PRIMARY KEY,
    user_id INT ,
    account varchar(255) unique,
    password VARCHAR(255)
);

CREATE TABLE teachers (
    teacher_id SERIAL PRIMARY KEY,
    user_id INT,
    account varchar(255) unique,
    password VARCHAR(255),
    invite_code VARCHAR(255),
    introduction TEXT,
    introduction_url VARCHAR(255)
);

CREATE TABLE students (
    student_id SERIAL PRIMARY KEY,
    user_id INT
);

## ***第二部分*** 课程模块

// 本来想,课程有一个subject，这个属于是一个大类,比如空中瑜伽,户外瑜伽...
// 应该在前端有一个数字和文字对应的数组，后端只存储有关的
// 从可扩展性的方面看,我有两种更好的方案
// 1. 在后端建一个表,一个subject表,然后添加管理员添加subject的操作,
// 这样就可以随意添加subject,然后主键就是作为存储的id,而前端每次都请求一次有哪些表
// 这个很复杂，我觉得可扩展会很差，而且对用户理解很不友好
// 2. 直接输入文字,只要前端进行定制即可
// 虽然看起来不算太好,但是优势其实非产多,作为最终方案
CREATE TABLE courses (
    course_id SERIAL PRIMARY KEY,
    admin_id INT,
    course_name VARCHAR(255),
    course_subject VARCHAR(255),
    introduction_url VARCHAR(255),
    introduction TEXT,
    is_group_type BOOLEAN,
    is_team_type BOOLEAN,
    is_vip_type BOOLEAN,
    recommend_max_num INT,
    recommend_min_num INT ,
    created_at TIMESTAMP
);


## ***第三部分*** 会员卡模块

CREATE TABLE card_lists (
    card_id SERIAL PRIMARY KEY,
    card_name VARCHAR(255) UNIQUE,
    brief_introduction_url VARCHAR(255),
    admin_account VARCHAR(255),
    card_introduction TEXT,
    card_introduction_url VARCHAR(255),
    is_support_group BOOLEAN,
    is_support_team BOOLEAN,
    is_support_vip BOOLEAN,
    is_limit_days BOOLEAN,
    is_limit_times BOOLEAN,
    is_forbid_special BOOLEAN,
    is_support_special BOOLEAN
);

-- 创建 card_purchase_records 表
CREATE TABLE card_purchase_records (
    purchase_id SERIAL PRIMARY KEY,
    admin_username VARCHAR(255),
    card_id int references card_lists(card_id),
    user_id INT UNIQUE NOT NULL,
    money INT,
    invite_teacher_id INT,
    start_date DATE,
    end_date DATE,
    times INT
);

-- 创建 card_forbid_lists 表
CREATE TABLE card_forbid_lists (
    id SERIAL PRIMARY KEY,
    card_id INT REFERENCES card_lists(card_id) ON DELETE CASCADE,
    course_id INT REFERENCES courses(course_id) ON DELETE CASCADE
);

-- 创建 card_support_lists 表
CREATE TABLE card_support_lists (
    id SERIAL PRIMARY KEY,
    card_id INT REFERENCES card_lists(card_id) ON DELETE CASCADE,
    course_id INT REFERENCES courses(course_id) ON DELETE CASCADE
);
## ***第三部分***

CREATE TABLE exam_record (
    id SERIAL PRIMARY KEY,
    user_id INT NOT NULL REFERENCES user(user_id),
    weight FLOAT,
    waist_circu FLOAT,
    chest_circu FLOAT,
    hip_circu FLOAT,
    body_fat FLOAT,
    plank_support FLOAT
);





CREATE TABLE class (
    class_id SERIAL PRIMARY KEY,
    course_id INT NOT NULL REFERENCES course(course_id),
    teacher_id INT NOT NULL REFERENCES teacher(teacher_id),
    is_auto_start BOOLEAN,
    is_week_auto BOOLEAN,
    is_month_auto BOOLEAN,
    week INT,
    hour INT,
    additional_remark TEXT,
    max_num INT,
    min_num INT
);

CREATE TABLE existing_class_instance (
    class_instance_id SERIAL PRIMARY KEY,
    course_id INT NOT NULL REFERENCES course(course_id),
    class_id INT NOT NULL REFERENCES class(class_id),
    teacher_id INT NOT NULL REFERENCES teacher(teacher_id),
    week INT,
    start_hour INT, -- Note: 'start_hour' should be of appropriate type, INT here for simplicity
    additional_remark TEXT,
    sign_in_num INT,
    reserve_num INT,
    summary TEXT,
    is_all_student_sign BOOLEAN
);

CREATE TABLE class_record (
    class_instance_id INT NOT NULL REFERENCES existing_class_instance(class_instance_id),
    course_id INT NOT NULL,
    class_id INT NOT NULL,
    teacher_id INT NOT NULL,
    week INT,
    start_hour INT, -- Note: 'start_hour' should be of appropriate type, INT here for simplicity
    additional_remark TEXT,
    sign_in_num INT,
    reserve_num INT,
    summary TEXT,
    is_all_student_sign BOOLEAN,
    max_num INT,
    min_num INT,
    PRIMARY KEY (class_instance_id) -- Assuming 'class_instance_id' is unique
);

CREATE TABLE reserve (
    id SERIAL PRIMARY KEY,
    class_id INT NOT NULL REFERENCES class(class_id),
    student_id INT NOT NULL REFERENCES student(student_id),
    is_canceled BOOLEAN,
    have_sign_in BOOLEAN
);

CREATE TABLE sign_in (
    id SERIAL PRIMARY KEY,
    class_instance_id INT NOT NULL REFERENCES existing_class_instance(class_instance_id),
    student_id INT NOT NULL REFERENCES student(student_id)
);

CREATE TABLE medal_list (
    medal_id SERIAL PRIMARY KEY,
    medal_name VARCHAR(255) NOT NULL,
    medal_introduction TEXT,
    medal_introduction_url VARCHAR(255),
    medal_type VARCHAR(50),
    medal_value INT
);

CREATE TABLE user_get_medal (
    id SERIAL PRIMARY KEY,
    user_id INT NOT NULL REFERENCES user(user_id),
    medal_id INT NOT NULL REFERENCES medal_list(medal_id),
    get_date DATE
);
